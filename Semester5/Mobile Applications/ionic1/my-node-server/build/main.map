{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.js","webpack:///external \"http\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-router\"","webpack:///external \"ws\""],"names":["Koa","require","app","server","createServer","callback","WebSocket","wss","Server","Router","cors","bodyparser","use","ctx","next","start","Date","ms","console","log","method","url","response","status","Promise","resolve","setTimeout","err","body","issue","error","message","Movie","constructor","id","title","budget","premiere","isOnTV","date","version","movies","dateStart","getTime","dateEnd","i","datePremiere","Math","random","budgetRandom","floor","push","toISOString","substring","toString","now","lastUpdated","length","lastId","pageSize","broadcast","data","clients","forEach","client","readyState","OPEN","send","JSON","stringify","router","get","ifModifiedSince","request","getMilliseconds","query","page","parseInt","set","toUTCString","sortedMovies","filter","movie","indexOf","sort","n1","n2","offset","movieId","params","find","warning","createMovie","event","payload","post","put","index","findIndex","movieVersion","del","splice","setInterval","routes","allowedMethods","listen"],"mappings":";;;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA,MAAMA,GAAG,GAAGC,mBAAO,CAAC,gBAAD,CAAnB;;AACA,MAAMC,GAAG,GAAG,IAAIF,GAAJ,EAAZ;;AACA,MAAMG,MAAM,GAAGF,mBAAO,CAAC,kBAAD,CAAP,CAAgBG,YAAhB,CAA6BF,GAAG,CAACG,QAAJ,EAA7B,CAAf;;AACA,MAAMC,SAAS,GAAGL,mBAAO,CAAC,cAAD,CAAzB;;AACA,MAAMM,GAAG,GAAG,IAAID,SAAS,CAACE,MAAd,CAAqB;AAACL;AAAD,CAArB,CAAZ;;AACA,MAAMM,MAAM,GAAGR,mBAAO,CAAC,8BAAD,CAAtB;;AACA,MAAMS,IAAI,GAAGT,mBAAO,CAAC,0BAAD,CAApB;;AACA,MAAMU,UAAU,GAAGV,mBAAO,CAAC,sCAAD,CAA1B;;AAEAC,GAAG,CAACU,GAAJ,CAAQD,UAAU,EAAlB;AACAT,GAAG,CAACU,GAAJ,CAAQF,IAAI,EAAZ;AACAR,GAAG,CAACU,GAAJ,CAAQ,OAAOC,GAAP,EAAYC,IAAZ,KAAqB;AACzB,QAAMC,KAAK,GAAG,IAAIC,IAAJ,EAAd;AACA,QAAMF,IAAI,EAAV;AACA,QAAMG,EAAE,GAAG,IAAID,IAAJ,KAAaD,KAAxB;AACAG,SAAO,CAACC,GAAR,CAAa,GAAEN,GAAG,CAACO,MAAO,IAAGP,GAAG,CAACQ,GAAI,IAAGR,GAAG,CAACS,QAAJ,CAAaC,MAAO,MAAKN,EAAG,IAApE;AACH,CALD;AAOAf,GAAG,CAACU,GAAJ,CAAQ,OAAOC,GAAP,EAAYC,IAAZ,KAAqB;AACzB,QAAM,IAAIU,OAAJ,CAAYC,OAAO,IAAIC,UAAU,CAACD,OAAD,EAAU,IAAV,CAAjC,CAAN;AACA,QAAMX,IAAI,EAAV;AACH,CAHD;AAKAZ,GAAG,CAACU,GAAJ,CAAQ,OAAOC,GAAP,EAAYC,IAAZ,KAAqB;AACzB,MAAI;AACA,UAAMA,IAAI,EAAV;AACH,GAFD,CAEE,OAAOa,GAAP,EAAY;AACVd,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAEH,GAAG,CAACI,OAAJ,IAAe;AAAvB,OAAD;AAAR,KAApB;AACAlB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH;AACJ,CAPD;;AASA,MAAMS,KAAN,CAAY;AACRC,aAAW,CAAC;AAACC,MAAD;AAAKC,SAAL;AAAYC,UAAZ;AAAoBC,YAApB;AAA8BC,UAA9B;AAAsCC,QAAtC;AAA4CC;AAA5C,GAAD,EAAuD;AAC9D,SAAKN,EAAL,GAAUA,EAAV;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,OAAL,GAAeA,OAAf;AACH;;AATO;;AAYZ,MAAMC,MAAM,GAAG,EAAf;AACA,MAAMC,SAAS,GAAG,IAAI1B,IAAJ,CAAS,IAAT,EAAe,CAAf,EAAkB2B,OAAlB,EAAlB;AACA,MAAMC,OAAO,GAAG,IAAI5B,IAAJ,GAAW2B,OAAX,EAAhB;;AACA,KAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB,QAAMC,YAAY,GAAG,IAAI9B,IAAJ,CAAS0B,SAAS,GAAGK,IAAI,CAACC,MAAL,MAAiBJ,OAAO,GAAGF,SAA3B,CAArB,CAArB;AACA,QAAMO,YAAY,GAAGF,IAAI,CAACG,KAAL,CAAWH,IAAI,CAACC,MAAL,KAAgB,KAA3B,IAAoC,IAAzD;AACAP,QAAM,CAACU,IAAP,CAAY,IAAInB,KAAJ,CAAU;AAClBE,MAAE,EAAG,GAAEW,CAAE,EADS;AAElBV,SAAK,EAAG,SAAQU,CAAE,EAFA;AAGlBT,UAAM,EAAEa,YAHU;AAIlBZ,YAAQ,EAAES,YAAY,CAACM,WAAb,GAA2BC,SAA3B,CAAqC,CAArC,EAAwC,EAAxC,CAJQ;AAKlBf,UAAM,EAAE,MAAMgB,QAAN,EALU;AAMlBf,QAAI,EAAE,IAAIvB,IAAJ,CAASA,IAAI,CAACuC,GAAL,KAAaV,CAAtB,CANY;AAOlBL,WAAO,EAAE;AAPS,GAAV,CAAZ;AASH;;AAED,IAAIgB,WAAW,GAAGf,MAAM,CAACA,MAAM,CAACgB,MAAP,GAAgB,CAAjB,CAAN,CAA0BlB,IAA5C;AACA,IAAImB,MAAM,GAAGjB,MAAM,CAACA,MAAM,CAACgB,MAAP,GAAgB,CAAjB,CAAN,CAA0BvB,EAAvC;AACA,MAAMyB,QAAQ,GAAG,EAAjB;;AAEA,MAAMC,SAAS,GAAGC,IAAI,IAClBtD,GAAG,CAACuD,OAAJ,CAAYC,OAAZ,CAAoBC,MAAM,IAAI;AAC1B,MAAIA,MAAM,CAACC,UAAP,KAAsB3D,SAAS,CAAC4D,IAApC,EAA0C;AACtCF,UAAM,CAACG,IAAP,CAAYC,IAAI,CAACC,SAAL,CAAeR,IAAf,CAAZ;AACH;AACJ,CAJD,CADJ;;AAOA,MAAMS,MAAM,GAAG,IAAI7D,MAAJ,EAAf;AAEA6D,MAAM,CAACC,GAAP,CAAW,QAAX,EAAqB1D,GAAG,IAAI;AACxB,QAAM2D,eAAe,GAAG3D,GAAG,CAAC4D,OAAJ,CAAYF,GAAZ,CAAgB,mBAAhB,CAAxB;;AACA,MAAIC,eAAe,IAAI,IAAIxD,IAAJ,CAASwD,eAAT,EAA0B7B,OAA1B,MAAuCa,WAAW,CAACb,OAAZ,KAAwBa,WAAW,CAACkB,eAAZ,EAAtF,EAAqH;AACjH7D,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CADiH,CACtF;;AAC3B;AACH;;AACD,QAAMY,KAAK,GAAGtB,GAAG,CAAC4D,OAAJ,CAAYE,KAAZ,CAAkBxC,KAAhC;AACA,QAAMyC,IAAI,GAAGC,QAAQ,CAAChE,GAAG,CAAC4D,OAAJ,CAAYE,KAAZ,CAAkBC,IAAnB,CAAR,IAAoC,CAAjD;AACA/D,KAAG,CAACS,QAAJ,CAAawD,GAAb,CAAiB,eAAjB,EAAkCtB,WAAW,CAACuB,WAAZ,EAAlC;AACA,QAAMC,YAAY,GAAGvC,MAAM,CACtBwC,MADgB,CACTC,KAAK,IAAI/C,KAAK,GAAG+C,KAAK,CAAC/C,KAAN,CAAYgD,OAAZ,CAAoBhD,KAApB,MAA+B,CAAC,CAAnC,GAAuC,IAD5C,EAEhBiD,IAFgB,CAEX,CAACC,EAAD,EAAKC,EAAL,KAAY,EAAED,EAAE,CAAC9C,IAAH,CAAQI,OAAR,KAAoB2C,EAAE,CAAC/C,IAAH,CAAQI,OAAR,EAAtB,CAFD,CAArB;AAGA,QAAM4C,MAAM,GAAG,CAACX,IAAI,GAAG,CAAR,IAAajB,QAA5B,CAZwB,CAaxB;AACA;AACA;AACA;AACA;;AACA9C,KAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoBa,MAApB;AACA5B,KAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH,CApBD;AAsBA+C,MAAM,CAACC,GAAP,CAAW,YAAX,EAAyB,MAAO1D,GAAP,IAAe;AACpC,QAAM2E,OAAO,GAAG3E,GAAG,CAAC4D,OAAJ,CAAYgB,MAAZ,CAAmBvD,EAAnC;AACA,QAAMgD,KAAK,GAAGzC,MAAM,CAACiD,IAAP,CAAYR,KAAK,IAAIM,OAAO,KAAKN,KAAK,CAAChD,EAAvC,CAAd;;AACA,MAAIgD,KAAJ,EAAW;AACPrE,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoBsD,KAApB;AACArE,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFO,CAEoB;AAC9B,GAHD,MAGO;AACHV,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAAC8D,eAAO,EAAG,iBAAgBH,OAAQ;AAAnC,OAAD;AAAR,KAApB;AACA3E,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFG,CAEwB;AAC9B;AACJ,CAVD;;AAYA,MAAMqE,WAAW,GAAG,MAAO/E,GAAP,IAAe;AAC/B,QAAMqE,KAAK,GAAGrE,GAAG,CAAC4D,OAAJ,CAAY7C,IAA1B;;AACA,MAAI,CAACsD,KAAK,CAAC/C,KAAX,EAAkB;AAAE;AAChBtB,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAE;AAAR,OAAD;AAAR,KAApB;AACAjB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFc,CAEa;;AAC3B;AACH;;AACD,MAAI,CAAC2D,KAAK,CAAC9C,MAAX,EAAmB;AACfvB,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAE;AAAR,OAAD;AAAR,KAApB;AACAjB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFe,CAEY;;AAC3B;AACH;;AACD,MAAI,CAAC2D,KAAK,CAAC7C,QAAX,EAAqB;AACjBxB,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAE;AAAR,OAAD;AAAR,KAApB;AACAjB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFiB,CAEU;;AAC3B;AACH;;AACD,MAAI,CAAC2D,KAAK,CAAC5C,MAAX,EAAmB;AACfzB,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAE;AAAR,OAAD;AAAR,KAApB;AACAjB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFe,CAEY;;AAC3B;AACH;;AACD2D,OAAK,CAAChD,EAAN,GAAY,GAAE2C,QAAQ,CAACnB,MAAD,CAAR,GAAmB,CAAE,EAAnC;AACAA,QAAM,GAAGwB,KAAK,CAAChD,EAAf;AACAgD,OAAK,CAAC3C,IAAN,GAAa,IAAIvB,IAAJ,EAAb;AACAkE,OAAK,CAAC1C,OAAN,GAAgB,CAAhB;AACAC,QAAM,CAACU,IAAP,CAAY+B,KAAZ;AACArE,KAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoBsD,KAApB;AACArE,KAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CA5B+B,CA4BJ;;AAC3BqC,WAAS,CAAC;AAACiC,SAAK,EAAE,SAAR;AAAmBC,WAAO,EAAE;AAACZ;AAAD;AAA5B,GAAD,CAAT;AACH,CA9BD;;AAgCAZ,MAAM,CAACyB,IAAP,CAAY,QAAZ,EAAsB,MAAOlF,GAAP,IAAe;AACjC,QAAM+E,WAAW,CAAC/E,GAAD,CAAjB;AACH,CAFD;AAIAyD,MAAM,CAAC0B,GAAP,CAAW,YAAX,EAAyB,MAAOnF,GAAP,IAAe;AACpC,QAAMqB,EAAE,GAAGrB,GAAG,CAAC4E,MAAJ,CAAWvD,EAAtB;AACA,QAAMgD,KAAK,GAAGrE,GAAG,CAAC4D,OAAJ,CAAY7C,IAA1B;AACAsD,OAAK,CAAC3C,IAAN,GAAa,IAAIvB,IAAJ,EAAb;AACA,QAAMwE,OAAO,GAAGN,KAAK,CAAChD,EAAtB;;AACA,MAAIsD,OAAO,IAAItD,EAAE,KAAKgD,KAAK,CAAChD,EAA5B,EAAgC;AAC5BrB,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAG;AAAT,OAAD;AAAR,KAApB;AACAjB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAF4B,CAED;;AAC3B;AACH;;AACD,MAAI,CAACiE,OAAL,EAAc;AACV,UAAMI,WAAW,CAAC/E,GAAD,CAAjB;AACA;AACH;;AACD,QAAMoF,KAAK,GAAGxD,MAAM,CAACyD,SAAP,CAAiBhB,KAAK,IAAIA,KAAK,CAAChD,EAAN,KAAaA,EAAvC,CAAd;;AACA,MAAI+D,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdpF,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAG,iBAAgBI,EAAG;AAA5B,OAAD;AAAR,KAApB;AACArB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFc,CAEa;;AAC3B;AACH;;AACD,QAAM4E,YAAY,GAAGtB,QAAQ,CAAChE,GAAG,CAAC4D,OAAJ,CAAYF,GAAZ,CAAgB,MAAhB,CAAD,CAAR,IAAqCW,KAAK,CAAC1C,OAAhE;;AACA,MAAI2D,YAAY,GAAG1D,MAAM,CAACwD,KAAD,CAAN,CAAczD,OAAjC,EAA0C;AACtC3B,OAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoB;AAACC,WAAK,EAAE,CAAC;AAACC,aAAK,EAAG;AAAT,OAAD;AAAR,KAApB;AACAjB,OAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAFsC,CAEX;;AAC3B;AACH;;AACD2D,OAAK,CAAC1C,OAAN;AACAC,QAAM,CAACwD,KAAD,CAAN,GAAgBf,KAAhB;AACA1B,aAAW,GAAG,IAAIxC,IAAJ,EAAd;AACAH,KAAG,CAACS,QAAJ,CAAaM,IAAb,GAAoBsD,KAApB;AACArE,KAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CA9BoC,CA8BT;;AAC3BqC,WAAS,CAAC;AAACiC,SAAK,EAAE,SAAR;AAAmBC,WAAO,EAAE;AAACZ;AAAD;AAA5B,GAAD,CAAT;AACH,CAhCD;AAkCAZ,MAAM,CAAC8B,GAAP,CAAW,YAAX,EAAyBvF,GAAG,IAAI;AAC5B,QAAMqB,EAAE,GAAGrB,GAAG,CAAC4E,MAAJ,CAAWvD,EAAtB;AACA,QAAM+D,KAAK,GAAGxD,MAAM,CAACyD,SAAP,CAAiBhB,KAAK,IAAIhD,EAAE,KAAKgD,KAAK,CAAChD,EAAvC,CAAd;;AACA,MAAI+D,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd,UAAMf,KAAK,GAAGzC,MAAM,CAACwD,KAAD,CAApB;AACAxD,UAAM,CAAC4D,MAAP,CAAcJ,KAAd,EAAqB,CAArB;AACAzC,eAAW,GAAG,IAAIxC,IAAJ,EAAd;AACA4C,aAAS,CAAC;AAACiC,WAAK,EAAE,SAAR;AAAmBC,aAAO,EAAE;AAACZ;AAAD;AAA5B,KAAD,CAAT;AACH;;AACDrE,KAAG,CAACS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB,CAT4B,CASD;AAC9B,CAVD;AAYA+E,WAAW,CAAC,MAAM;AACd9C,aAAW,GAAG,IAAIxC,IAAJ,EAAd;AACA0C,QAAM,GAAI,GAAEmB,QAAQ,CAACnB,MAAD,CAAR,GAAmB,CAAE,EAAjC;AACA,QAAMZ,YAAY,GAAG,IAAI9B,IAAJ,CAAS0B,SAAS,GAAGK,IAAI,CAACC,MAAL,MAAiBJ,OAAO,GAAGF,SAA3B,CAArB,CAArB;AACA,QAAMO,YAAY,GAAGF,IAAI,CAACG,KAAL,CAAWH,IAAI,CAACC,MAAL,KAAgB,KAA3B,IAAoC,IAAzD;AACA,QAAMkC,KAAK,GAAG,IAAIlD,KAAJ,CAAU;AACpBE,MAAE,EAAEwB,MADgB;AAEpBvB,SAAK,EAAG,SAAQuB,MAAO,EAFH;AAGpBtB,UAAM,EAAEa,YAHY;AAIpBZ,YAAQ,EAAES,YAAY,CAACM,WAAb,GAA2BC,SAA3B,CAAqC,CAArC,EAAwC,EAAxC,CAJU;AAKpBf,UAAM,EAAE,MAAMgB,QAAN,EALY;AAMpBf,QAAI,EAAEiB,WANc;AAOpBhB,WAAO,EAAE;AAPW,GAAV,CAAd;AASAC,QAAM,CAACU,IAAP,CAAY+B,KAAZ;AACAhE,SAAO,CAACC,GAAR,CAAa,GAAE+D,KAAK,CAAC/C,KAAM,EAA3B;AACAyB,WAAS,CAAC;AAACiC,SAAK,EAAE,SAAR;AAAmBC,WAAO,EAAE;AAACZ;AAAD;AAA5B,GAAD,CAAT;AACH,CAjBU,EAiBR,MAjBQ,CAAX;AAmBAhF,GAAG,CAACU,GAAJ,CAAQ0D,MAAM,CAACiC,MAAP,EAAR;AACArG,GAAG,CAACU,GAAJ,CAAQ0D,MAAM,CAACkC,cAAP,EAAR;AAEArG,MAAM,CAACsG,MAAP,CAAc,IAAd,E;;;;;;;;;;;;;;;;;;;;;;;ACpNA,iC;;;;;;;;;;;ACAA,gC;;;;;;;;;;;ACAA,2C;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,uC;;;;;;;;;;;ACAA,+B","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const Koa = require('koa');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({server});\r\nconst Router = require('koa-router');\r\nconst cors = require('koa-cors');\r\nconst bodyparser = require('koa-bodyparser');\r\n\r\napp.use(bodyparser());\r\napp.use(cors());\r\napp.use(async (ctx, next) => {\r\n    const start = new Date();\r\n    await next();\r\n    const ms = new Date() - start;\r\n    console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n});\r\n\r\napp.use(async (ctx, next) => {\r\n    await new Promise(resolve => setTimeout(resolve, 2000));\r\n    await next();\r\n});\r\n\r\napp.use(async (ctx, next) => {\r\n    try {\r\n        await next();\r\n    } catch (err) {\r\n        ctx.response.body = {issue: [{error: err.message || 'Unexpected error'}]};\r\n        ctx.response.status = 500;\r\n    }\r\n});\r\n\r\nclass Movie {\r\n    constructor({id, title, budget, premiere, isOnTV, date, version}) {\r\n        this.id = id;\r\n        this.title = title;\r\n        this.budget = budget;\r\n        this.premiere = premiere;\r\n        this.isOnTV = isOnTV;\r\n        this.date = date;\r\n        this.version = version;\r\n    }\r\n}\r\n\r\nconst movies = [];\r\nconst dateStart = new Date(1900, 0).getTime();\r\nconst dateEnd = new Date().getTime();\r\nfor (let i = 0; i < 3; i++) {\r\n    const datePremiere = new Date(dateStart + Math.random() * (dateEnd - dateStart));\r\n    const budgetRandom = Math.floor(Math.random() * 10000) + 3000;\r\n    movies.push(new Movie({\r\n        id: `${i}`,\r\n        title: `movie ${i}`,\r\n        budget: budgetRandom,\r\n        premiere: datePremiere.toISOString().substring(0, 10),\r\n        isOnTV: false.toString(),\r\n        date: new Date(Date.now() + i),\r\n        version: 1\r\n    }));\r\n}\r\n\r\nlet lastUpdated = movies[movies.length - 1].date;\r\nlet lastId = movies[movies.length - 1].id;\r\nconst pageSize = 10;\r\n\r\nconst broadcast = data =>\r\n    wss.clients.forEach(client => {\r\n        if (client.readyState === WebSocket.OPEN) {\r\n            client.send(JSON.stringify(data));\r\n        }\r\n    });\r\n\r\nconst router = new Router();\r\n\r\nrouter.get('/movie', ctx => {\r\n    const ifModifiedSince = ctx.request.get('If-Modified-Since');\r\n    if (ifModifiedSince && new Date(ifModifiedSince).getTime() >= lastUpdated.getTime() - lastUpdated.getMilliseconds()) {\r\n        ctx.response.status = 304; // NOT MODIFIED\r\n        return;\r\n    }\r\n    const title = ctx.request.query.title;\r\n    const page = parseInt(ctx.request.query.page) || 1;\r\n    ctx.response.set('Last-Modified', lastUpdated.toUTCString());\r\n    const sortedMovies = movies\r\n        .filter(movie => title ? movie.title.indexOf(title) !== -1 : true)\r\n        .sort((n1, n2) => -(n1.date.getTime() - n2.date.getTime()));\r\n    const offset = (page - 1) * pageSize;\r\n    // ctx.response.body = {\r\n    //   page,\r\n    //   movies: sortedMovies.slice(offset, offset + pageSize),\r\n    //   more: offset + pageSize < sortedMovies.length\r\n    // };\r\n    ctx.response.body = movies;\r\n    ctx.response.status = 200;\r\n});\r\n\r\nrouter.get('/movie/:id', async (ctx) => {\r\n    const movieId = ctx.request.params.id;\r\n    const movie = movies.find(movie => movieId === movie.id);\r\n    if (movie) {\r\n        ctx.response.body = movie;\r\n        ctx.response.status = 200; // ok\r\n    } else {\r\n        ctx.response.body = {issue: [{warning: `movie with id ${movieId} not found`}]};\r\n        ctx.response.status = 404; // NOT FOUND (if you know the resource was deleted, then return 410 GONE)\r\n    }\r\n});\r\n\r\nconst createMovie = async (ctx) => {\r\n    const movie = ctx.request.body;\r\n    if (!movie.title) { // validation\r\n        ctx.response.body = {issue: [{error: 'Title is missing'}]};\r\n        ctx.response.status = 400; //  BAD REQUEST\r\n        return;\r\n    }\r\n    if (!movie.budget) {\r\n        ctx.response.body = {issue: [{error: 'Budget is missing'}]};\r\n        ctx.response.status = 400; //  BAD REQUEST\r\n        return;\r\n    }\r\n    if (!movie.premiere) {\r\n        ctx.response.body = {issue: [{error: 'Premiere date is missing'}]};\r\n        ctx.response.status = 400; //  BAD REQUEST\r\n        return;\r\n    }\r\n    if (!movie.isOnTV) {\r\n        ctx.response.body = {issue: [{error: 'IsOnTV for movie is missing'}]};\r\n        ctx.response.status = 400; //  BAD REQUEST\r\n        return;\r\n    }\r\n    movie.id = `${parseInt(lastId) + 1}`;\r\n    lastId = movie.id;\r\n    movie.date = new Date();\r\n    movie.version = 1;\r\n    movies.push(movie);\r\n    ctx.response.body = movie;\r\n    ctx.response.status = 201; // CREATED\r\n    broadcast({event: 'created', payload: {movie}});\r\n};\r\n\r\nrouter.post('/movie', async (ctx) => {\r\n    await createMovie(ctx);\r\n});\r\n\r\nrouter.put('/movie/:id', async (ctx) => {\r\n    const id = ctx.params.id;\r\n    const movie = ctx.request.body;\r\n    movie.date = new Date();\r\n    const movieId = movie.id;\r\n    if (movieId && id !== movie.id) {\r\n        ctx.response.body = {issue: [{error: `Param id and body id should be the same`}]};\r\n        ctx.response.status = 400; // BAD REQUEST\r\n        return;\r\n    }\r\n    if (!movieId) {\r\n        await createMovie(ctx);\r\n        return;\r\n    }\r\n    const index = movies.findIndex(movie => movie.id === id);\r\n    if (index === -1) {\r\n        ctx.response.body = {issue: [{error: `movie with id ${id} not found`}]};\r\n        ctx.response.status = 400; // BAD REQUEST\r\n        return;\r\n    }\r\n    const movieVersion = parseInt(ctx.request.get('ETag')) || movie.version;\r\n    if (movieVersion < movies[index].version) {\r\n        ctx.response.body = {issue: [{error: `Version conflict`}]};\r\n        ctx.response.status = 409; // CONFLICT\r\n        return;\r\n    }\r\n    movie.version++;\r\n    movies[index] = movie;\r\n    lastUpdated = new Date();\r\n    ctx.response.body = movie;\r\n    ctx.response.status = 200; // OK\r\n    broadcast({event: 'updated', payload: {movie}});\r\n});\r\n\r\nrouter.del('/movie/:id', ctx => {\r\n    const id = ctx.params.id;\r\n    const index = movies.findIndex(movie => id === movie.id);\r\n    if (index !== -1) {\r\n        const movie = movies[index];\r\n        movies.splice(index, 1);\r\n        lastUpdated = new Date();\r\n        broadcast({event: 'deleted', payload: {movie}});\r\n    }\r\n    ctx.response.status = 204; // no content\r\n});\r\n\r\nsetInterval(() => {\r\n    lastUpdated = new Date();\r\n    lastId = `${parseInt(lastId) + 1}`;\r\n    const datePremiere = new Date(dateStart + Math.random() * (dateEnd - dateStart));\r\n    const budgetRandom = Math.floor(Math.random() * 10000) + 3000;\r\n    const movie = new Movie({\r\n        id: lastId,\r\n        title: `movie ${lastId}`,\r\n        budget: budgetRandom,\r\n        premiere: datePremiere.toISOString().substring(0, 10),\r\n        isOnTV: false.toString(),\r\n        date: lastUpdated,\r\n        version: 1\r\n    });\r\n    movies.push(movie);\r\n    console.log(`${movie.title}`);\r\n    broadcast({event: 'created', payload: {movie}});\r\n}, 150000);\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(3000);\r\n","module.exports = require(\"http\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-cors\");","module.exports = require(\"koa-router\");","module.exports = require(\"ws\");"],"sourceRoot":""}